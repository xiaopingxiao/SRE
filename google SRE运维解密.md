## 第一章
### 介绍
#### 系统管理员模式
系统管理员只要运维复杂的计算机系统，随着公司扩张和业务的增长，组件越来越多，用户流量不断上升，通常在公司中分属两个不同的部门，开发部（dev），运维部(ops)。但是，很少有人提及这样做以及相应造成的dev/ops分离的团队的模型存在一些无法避免的问题，以下从两个方面阐述。
1. 直接成本：直接成本相对清晰，因为系统管理员大部分依赖人工处理系统维护事件以及变更的措施，随着系统的负责度增加，部署规模的扩大，系统管理员会与系统负责成线性增长。
2. 简介成本：研发团队和系统运维团队分属两个部门所带来的间接成本不好度量，但是这个成本大得多，由于研发和运维背景各异，技术能力和工具习惯差距较大，工作目标截然不同，
   具体执行汇总对某项操作的危险程度评估与可能得技术防范措施也有截然不同的理解，在这些细节上容易堆积分歧，最后形成内部沟通问题，直至上升到信任和尊重层面。
研发团队和运维团队主要在软件新版本，新配置的变更的发布速度上，研发部门最关注的是如何能够更快构建发布新应用，运维关注的是如何能在值班期间避免发生故障，由于大部分故障是由于变更导致。这两个部门从本质上来说是互相矛盾的。
研发部门想要随时随地发布新功能，没有任何阻拦；运维部门想要软件能运行就不要动。在现实生活中，公司内部这两股力量会通过各种方式保障各自的利益，运维团队会宣称任何变更上线前都必须经过由运维团队制定的流程，这有助于避免故障的发生，
而开发团队吃过苦头则不再进行大规模更新，而是组件转为功能开关调整，增量更新，以及补丁化，采用这些名称绕过运维部门设立的各种流程，实现快速上线。
##### sre这种模式是google尝试从根本上避免产生这种矛盾的结果，sre团队通过软件工程师创造软件系统来维护系统运行以替代传统模型中的人工操作。
sre的构成：sre团队基本有两类工程师。
第一类：团队中50-60%是标准软件工程师，按照软件工程师标准招聘流程的人
第二类：40-50%是具备软件工程师80~90%的技能，并且具备unix，网络等专业技能。
SRE成员具有如下特点。
1. 对重复性，手工的操作有天然的排斥感。
2. 有足够的技术能力快速开发出软件系统以替代手工操作。
如果一个产品非常成功，用户流量越来越大，就需要更多的团队成员来重复进行同样的事情，为了避免这一点，负责运维的团队必须有足够的时间编程，否则他妈呢就会被运维工作所淹没，因此google为整个sre团队做的所有传统运维工作设立了一个50%的上限值，
传统运维包括工单处理，手工操作等，随着时间的推移，sre应该倾向于将基本的运维工作消除，投入到研发工作上。我们的终极目标是无人化运行，而不是自动化某些人工流程。
sre团队必须将50%的精力花在真实的开发上，才能保证他妈呢有足够的时间和精力去进行真正有创造性，自主的研发工作。
devops 还是 sre，都是为了通过自动化解决人工操作，SRE是devops的具体实践和扩展。

#### sre方法论
sre团队要承担以下几类职责：可用性改造，延迟优化，性能优化，效率优化，变更管理，监控，紧急事务处理，容量规划与管理。
#### 确保长期关注研发工作
运维工作限制在50%以内，然后将剩余时间花在研发上，如果有必要，可以采取一些暂时性操作讲过多的运维压力转移回研发处理，SRE处理运维的准则是：每8-12小时的oncall轮值期间最多只处理两个紧急事件，这样sre可以正确处理故障，恢复服务，并且要撰写一份事后报告，
所有产品事故都应该有对应的时候总结，无论有没有出发报警，如果一个事故没有触发报警，事后总结的意义更大，因为它揭示监控系统的漏洞，事后总结应该包含以下内容，事故发生，发现，解决的全过程。事故的根本原因是预防和优化解决方案，google的原则是"对事不对人"，
目标是尽早发现和堵住漏洞，而不是通过流程去绕过和掩盖他们。
#### 在保障SLO的前提下最大化迭代速度
产品研发部门和sre之间可以通过消除组织架构冲突来构建良好的合作关系，
"错误预算" 起源于这样的一个理念，任何产品都不是，也不应该做到100%可靠，一般来说任何系统都不应该一味追求100%可靠，因为对用户来说，99.999%和100%是没有任何区别的，就算我们将系统变为100%可靠，也不能给用户带来任何实质上意义上的好处，
一个部门或者产品必须建立一个合理的可靠性目标，一旦建立，"错误预算" 就是 1- 可靠性目标，研发团队可以用这个错误预算上线新功能，吸引新用户。理想情况下，我们应该使用错误预算来最大化新功能上线的速度，同事保障服务质量。
通过引入错误预算的概念，解决了研发团队和sre团队之间的结构冲突，sre团队不再是零事故运行，sre和研发的目标基本一致都是尽可能地快速加快功能上线速度，这个改动虽小，意义重大。
#### 监控系统
监控系统是sre团队监控服务质量和可用性的一个主要手段，最普遍的报警是针对某一个特定的情况或者监控值时，一旦出现情况就发email劲爆，但是这样的策略不是非常有效的，一个需要人工阅读和分析警报来决定目前是否可以采取某种行动的系统从本质上来说就是错误的，
监控系统不应该依赖人来分析警报信息，而应该是由系统自动分析，仅当需要用户执行操作时才需要通知用户。
一个监控系统应该只有三类输出：
1. 紧急警报
意味着收到报警的用户需要立即执行某种操作，目标是解决某种以及发生的问题。
3. 工单
意味着接受工单的用户应该执行某种操作，但不是立即执行，系统不能自动解决这种情况，
5. 日志
平时没有人需要关注日志，但是日志依然收集起来以便事后分析。
可靠性是MTTF（平均失败时间）和MTTR（平均恢复时间）的函数，任何需要人工操作的事情都只会延长恢复时间，一个可以自动恢复的系统及时有更多的故障发生也比事事都需要人工干预的系统可用性更高。
